// This is your Prisma schema file for ANALYTICS DATABASE
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../app/prisma-analytics"
}

datasource db {
  provider = "postgresql"
}

/**
 * ============================================================
 * ANALYTICS & HISTORICAL DATA TABLES
 * ============================================================
 */

enum ActivityType {
  TEAM_CREATED
  TOURNAMENT_CREATED
  GAME_PLAYED
  GAME_WON
  MEMBER_ADDED
  PAYMENT_MADE
}

enum AchievementCategory {
  GAMES
  WINS
  TOURNAMENTS
  SOCIAL
  SPECIAL
}

enum AchievementTier {
  BRONZE
  SILVER
  GOLD
  PLATINUM
  DIAMOND
}

/**
 * Activity Logs - User actions and events
 */
model Activity {
  id        String       @id @default(cuid())
  userId    String
  type      ActivityType
  refId     String?
  message   String?
  createdAt DateTime     @default(now())

  @@index([userId])
  @@index([createdAt])
  @@index([type])
}

/**
 * Email Logs - Sent email tracking
 */
model EmailLog {
  id        String   @id @default(cuid())
  recipient String
  subject   String
  body      String   @db.Text
  status    String   @default("PENDING") // PENDING, SENT, FAILED
  error     String?
  createdAt DateTime @default(now())
  sentAt    DateTime?
  userId    String?

  @@index([userId])
  @@index([status])
  @@index([createdAt])
}

/**
 * Achievement System
 */
model Achievement {
  id          String             @id @default(cuid())
  key         String             @unique
  name        String
  description String
  icon        String
  category    AchievementCategory
  tier        AchievementTier
  criteria    Json
  createdAt   DateTime           @default(now())

  userAchievements UserAchievement[]

  @@index([category])
  @@index([tier])
}

model UserAchievement {
  id            String   @id @default(cuid())
  userId        String
  achievementId String
  unlockedAt    DateTime @default(now())
  progress      Int      @default(100)

  achievement Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  @@unique([userId, achievementId])
  @@index([userId])
  @@index([unlockedAt])
}

/**
 * ELO History - Track rating changes over time (future)
 */
model EloHistory {
  id        String   @id @default(cuid())
  userId    String
  rating    Int
  change    Int
  gameId    String?
  timestamp DateTime @default(now())
  
  @@index([userId])
  @@index([timestamp])
}
